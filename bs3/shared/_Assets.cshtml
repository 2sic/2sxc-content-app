@using DotNetNuke.Framework.JavaScriptLibraries;
@* show warning for admin if koi.json is missing *@
@RenderPage("_Koi Admin Messages.cshtml")

@* include icon font *@
<script defer async src="https://use.fontawesome.com/releases/v5.12.0/js/all.js"></script>

@*
  This sub template just places all the very-often used
  style and link tags into the code.
  We put this in a sub-template because we use it so often, and want to make sure
  nobody accidentally uses the wrong url or forgets data-enableoptimizations
*@
@{

  var page = GetService<ToSic.Sxc.Web.IPageService>();  // Service to set titles etc. on the page


  string partList = PageData["parts"];
  var parts = partList.Split(',').Select(s => ((string)s).ToLower().Trim()).ToArray();
  var all = parts.Contains("all");
  var fancybox = all || parts.Contains("fancybox");
  var styles = all || parts.Contains("styles");
  var scripts = all || parts.Contains("scripts");
  var height = all || parts.Contains("height");
  var videos = all || parts.Contains("videos");
}
@if(fancybox || scripts)
{
  // tell DNN to load jquery as it's needed by fancybox and our basic scripts
  JavaScript.RequestRegistration(CommonJs.jQuery);
}
@if(fancybox)
{
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" data-enableoptimizations="bottom" />
  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js" data-enableoptimizations="bottom"></script>
}

@if(styles) { <link rel="stylesheet" href="@App.Path/dist/bs3.min.css" data-enableoptimizations="true" /> }
@if(scripts) { <script type="text/javascript" src="@App.Path/dist/scripts.min.js" data-enableoptimizations="bottom"></script> }
@if(height) { <script type="text/javascript" src="@App.Path/dist/lib/jquery.syncHeightResponsive.min.js" data-enableoptimizations="bottom"></script> }

@* include video assets as needed by iframe-embed mode *@

@if (videos) {
  page.Activate("turnOn"); // see https://r.2sxc.org/turnon
  <script type="text/javascript" src="@App.Path/dist/scripts.min.js" data-enableoptimizations="bottom"></script> 
  @* Trigger protected mails to appear; activation uses turnOn https://r.2sxc.org/turnon *@
  <turnOn turn-on='{ "await": ["window.$"], "run": "window.appContent.showEncryptedMails()" }'></turnOn>
}

@* Turn On various features as needed. Activation uses turnOn https://r.2sxc.org/turnon *@
@if (videos) {
  <turnOn turn-on='{ "await": ["window.$"], "run": "window.appContent.activateYouTubeInline()" }'></turnOn>
}