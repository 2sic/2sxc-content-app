@* 
    this is a partial template which is re-used in many other templates, 
    so it's shared here  
*@
@{
    // configuration
    var retina = true;
    var quality = 75;

    // this is the parameter passed in from the calling page
    int width = PageData["width"];
    if(retina) {
        width += width; // double if retina
        quality = 50;
    }

    // prepare the title, either the default or the additional image caption
    var title="";
    if(Presentation.TitleLightbox){
        if(!String.IsNullOrEmpty(Content.ImageCaption)){
            title=Content.ImageCaption;
        } else {
            title=Content.Title;
        }
    }

    // has image? add lightbox link?
    var hasImage = !String.IsNullOrEmpty(Content.Image);
    var withLink = Presentation.ImageLightbox != null && Presentation.ImageLightbox;
}

@if(hasImage) {
    if (withLink) {
        @:<a title="@title" class="fancybox" href="@Content.Image?maxwidth=1400&amp;maxheight=990">
    }
    <img class="co-content-image" src="@Content.Image?w=@width&amp;quality=@quality" alt="@title" />
    if (withLink) {
        @:</a>
    }
}