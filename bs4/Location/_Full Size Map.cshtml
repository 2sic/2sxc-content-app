@inherits ToSic.Sxc.Dnn.RazorComponent
@using ToSic.Razor.Blade;
@* This adds all link/script tags *@
@RenderPage("../shared/_Assets.cshtml", new { parts = "scripts"})
<script type="text/javascript" src="@App.Path/dist/lib/google-map.js" data-enableoptimizations="true"></script>

@{
  var language = Dnn.Portal.CultureCode.Split(new[] { '-' })[0];
  var directionurl = "https://maps.google.com/maps?daddr="+Content.Street.Replace(" ", "+")+"+"+Content.ZipCode.Replace(" ", "+")+"+"+Content.City.Replace(" ", "+")+"+"+Content.Country.Replace(" ", "+")+"&amp;saddr=&amp;f=d&amp;hl=" + language + "&amp;ie=UTF8&amp;z=16";
  if (Convert.ToInt32(Content.GPSLng) > 0) {
    directionurl = "https://www.google.com/maps/dir//"+Content.GPSLat.ToString().Replace(',', '.')+","+Content.GPSLng.ToString().Replace(',', '.');
  }
}

<div class="co-container-outer mb-4 mb-md-5">
	<div class="co-container-inner" @Edit.TagToolbar(Content)>
		<div class="co-google-map-container embed-responsive embed-responsive-21by9">
			<div class="embed-responsive-item" id="GoogleMap-@Dnn.Module.ModuleID"></div>
			<div id="GoogleMap-Content-@Dnn.Module.ModuleID" style="display:none;">
				<div class="p-2 text-center">
					<h4>@Content.Company</h4>
					<div>@Html.Raw(Content.Description)</div>
					<a class="btn btn-outline-primary" target="_blank" href="@directionurl">@Content.LabelDirections</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		var markerImage = "@((Text.Has(Content.Presentation.MarkerImage)) ? Content.Presentation.MarkerImage : "")";
		$("#GoogleMap-@(Dnn.Module.ModuleID)").toGoogleMap({
			position: {
				lat: @Content.GPSLat.ToString().Replace(',', '.'),
				lng: @Content.GPSLng.ToString().Replace(',', '.')
			},
			zoom: @Content.Presentation.Zoom,
			mapTypeId: "ROADMAP",
			infoWindowHtml: $("#GoogleMap-Content-@Dnn.Module.ModuleID").html(),
			showInfoWindow: true,
			icon: markerImage
		});
	});
</script>
