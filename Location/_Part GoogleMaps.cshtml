@inherits Custom.Hybrid.Razor12
@using ToSic.Razor.Blade;
@{
  // get key from settings and remove empty lines
  // will also add warning! in front, if the settings say to include a warning
  var warning = (Settings.GoogleMapsShowWarning ? "warning!" : "");
  var key = warning + Settings.GoogleMapsKey.Replace("\n", ""); 
}
<script>
  var googleMapsApiKey = "@key";
</script>

<script type="text/javascript">
  (function () {
    // for now we must queue the init calls - our maps library will pick this up later on to init once it's ready
    const appC = window.appContent = window.appContent || { }
    const mapQueue = appC.mapQueue = appC.mapQueue || [];
    mapQueue.push(
      function() {
        var markerImage = "@Text.First(DynamicModel.markerImage, "")";
        $("#GoogleMap-@(DynamicModel.mapId)").toGoogleMap({
          position: {
            lat: @DynamicModel.mapInfo.GpsLat.ToString().Replace(",","."),
            lng: @DynamicModel.mapInfo.GpsLong.ToString().Replace(",",".")
          },
          zoom: @Content.Presentation.Zoom,
          mapTypeId: "ROADMAP",
          infoWindowHtml: "@DynamicModel.company",
          showInfoWindow: false,
          icon: markerImage
        });
      });
    if(window.appContent.processQueue)
      window.appContent.processQueue();
  })();
</script>