@inherits Custom.Hybrid.Razor12
@using ToSic.Razor.Blade;
@using Newtonsoft.Json;
@{
  // They Google API key is in the App-Settings. See instructions: https://azing.org/2sxc/r/ippFQYkz
  // Get key from settings and remove empty lines. 
  var key = Settings.GoogleMapsKey.Replace("\n", ""); 

  // Activate turnOn in the page - see https://r.2sxc.org/turnon
  GetService<ToSic.Sxc.Web.IPageService>().Activate("turnOn");
}

@* Instruct turnOn to activate GoogleMaps with the API key once everything is loaded - uses turnOn https://r.2sxc.org/turnon *@
<turnOn turn-on='{ "await": ["window.$"], "run": "window.appContent.maps.load()", "data": "@key" }'></turnOn>

@* Instruct turnOn to init this specific Map once everything is loaded - uses turnOn https://r.2sxc.org/turnon *@
<turnOn turn-on='{ "run": "window.appContent.maps.configureMap()", "data": { 
  "domId": "GoogleMap-@DynamicModel.mapId", 
  "marker": "@Text.First(DynamicModel.markerImage, "")",
  "lat": @DynamicModel.mapInfo.GpsLat.ToString("R"),
  "lng": @DynamicModel.mapInfo.GpsLong.ToString("R"), 
  "zoom": @Content.Presentation.Zoom, 
  "info": "@DynamicModel.company",
  "warn": @(Settings.GoogleMapsShowWarning ? "true" : "false")
}}'></turnOn>