@inherits Custom.Hybrid.Razor12
@{
  // get CSS information about the current Theme
  var pageCss = GetService<Connect.Koi.ICss>();
}
@* show warning for admin if koi.json is missing *@
@Html.Partial("_Koi Admin Messages.cshtml")

@{
  // Include bootstrap 4 if the framework isn't known - then this file is still called, and we add Bootstrap to the page 
  if(!pageCss.Is("bs4")) { 
    // Note that the link and script tags are in the App Settings to make it easier to update a live installation
    @Html.Raw(App.Settings.AssetsBootstrap) 
  }
}

@{
  // This sub template just places all the very-often used
  // style and link tags into the code.
  // We put this in a sub-template because we use it so often, and want to make sure
  // nobody accidentally uses the wrong url or forgets data-enableoptimizations
  string partList = DynamicModel.parts;
  var parts = partList.Split(',').Select(s => ((string)s).ToLower().Trim()).ToArray();
  var all = parts.Contains("all");
  var fancybox = all || parts.Contains("fancybox");
  var styles = all || parts.Contains("styles");
  var scripts = all || parts.Contains("scripts");
  var height = all || parts.Contains("height");
  var icons = all || parts.Contains("icons");
  var lazy = all || parts.Contains("lazy");

  // Include icon font - the exact HTML for this is in the App Settings
  if(icons) {
    @Html.Raw(App.Settings.AssetsIconFont);
  }

  // tell DNN to load jquery as it's needed by fancybox and our basic scripts
  // Oqtane doesn't need this, as jQuery is always preloaded as of now
  if(fancybox || scripts) {
    #if !NETCOREAPP
      DotNetNuke.Framework.JavaScriptLibraries.JavaScript.RequestRegistration(DotNetNuke.Framework.JavaScriptLibraries.CommonJs.jQuery);
    #endif
  }

}

@* Add Fancybox if required - as specified in the App Settings *@
@if(fancybox) { @Html.Raw(App.Settings.AssetsFancybox) }

@* Add Lazyload if required - as specified in the App Settings *@
@if(lazy) { @Html.Raw(App.Settings.AssetsLazyload) }

@if(styles) { <link rel="stylesheet" href="@App.Path/dist/bs4.min.css" data-enableoptimizations="true" /> }
@if(scripts) { 
  <script type="text/javascript" src="@App.Path/dist/scripts.min.js" data-enableoptimizations="bottom"></script> 
  <script type="text/javascript">
    // if reloaded on a dynamic page, re-activate all parts - just ensure the objects exist
    $(function() { if(window.appContent && window.appContent.activateAll) window.appContent.activateAll() });
  </script>
}
