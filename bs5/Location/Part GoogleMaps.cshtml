@inherits AppCode.Razor.AppRazor
@using ToSic.Razor.Blade
@using AppCode.Data

@{
  // They Google API key is in the App-Settings. See instructions: https://azing.org/2sxc/r/ApSwlItl
  // The Preset-data is encrypted, so we must decrypt it to use
  var googleApikey = Kit.SecureData.Parse(AllSettings.String("GoogleMaps.ApiKey")).Value;

  var location = As<Location>(MyItem);

  // GPS is a JSON field, so we must use AsDynamic to easily access the properties
  var gps = location.GpsCoordinates;

  var data = new {
    apiKey = googleApikey,
    domId = MyModel.String("DomId"),
    icon = AllSettings.String("GoogleMaps.MarkerIcon") ?? "",
    lat = gps.Latitude,
    lng = gps.Longitude,
    zoom = AllSettings.Int("GoogleMaps.Zoom"),
    info = location.Company,
  };
}

@* Instruct turnOn to activate GoogleMaps with the API key and everything once everything is loaded - uses turnOn https://r.2sxc.org/turnon *@
@Kit.Page.TurnOn("window.appContent.activeGoogleMaps()", data: data)
